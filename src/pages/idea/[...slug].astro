---
import { getCollection, render } from "astro:content";
import Layout from "@layouts/Layout.astro";
import Drawer from "@layouts/Drawer.astro";

import Tags from "@components/Tags.astro";

export async function getStaticPaths() {
  const ideas = await getCollection("ideas");
  return ideas.map(idea => {
    let slug = idea.filePath
    slug = slug?.replace(/^idea\//, "");
    slug = slug?.replace(/\.mdx?$/, "");
    return {
      params: { slug },
      props : { idea },
    }
  });
}

const { idea    } = Astro.props;
const { Content } = await render(idea);
---

<Layout>
  <Drawer>
    <div class="flex flex-col w-full items-center">
      <div class="flex flex-col w-[960px] min-h-dvh items-center">
        <div class="flex flex-col w-full items-center p-4">
          <span class="text-4xl font-bold text-center">{idea.data.title}</span>
          <div class="flex flex-row w-full justify-center gap-2 text-xl">
            <span>{idea.data.author                 }</span>
            { (idea.data.author && idea.data.pubDate) ? "|" : "" }
            <span>{idea.data.pubDate?.toDateString()}</span>
          </div>
          <Tags tags={idea.data.tags}/>
        </div>
        <div class="flex flex-col w-full p-8 prose shadow-lg flex-1">
          <Content/>
        </div>
      </div>
    </div>
  </Drawer>
</Layout>